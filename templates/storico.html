<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Storico modifiche record {{ record_id }}</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css" />
</head>
<body>
<section class="section">
<div class="container">

<a class="button is-link" href="{{ url_for('index') }}">Home</a>

<a href="javascript:history.back()" class="button is-link">Indietro</a>


<h1 class="title mt-5">Storico modifiche per Record ID {{ record_id }}</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
  {% for category, message in messages %}
    <div class="notification is-{{ category }}">
      {{ message }}
    </div>
  {% endfor %}
{% endif %}
{% endwith %}


{% if audits %}
<table class="table is-striped is-fullwidth mt-5">
<thead>
<tr>
<th>Operazione</th>
<th>Eseguito da</th>
<th>Data</th>
<th>Dettaglio Modifiche</th>
</tr>
</thead>
<tbody>
{% for a in audits %}
<tr>
<td>{{ a.operation_type }}</td>
<td>{{ a.executed_by or '—' }}</td>
<td>{{ a.executed_at.strftime('%d/%m/%Y %H:%M') }}</td>
<td>
<table class="table is-fullwidth is-size-7">
<thead>
    <tr>
        <th>Campo</th>
        <th>Vecchio valore</th>
        <th>Nuovo valore</th>
    </tr>
</thead>
<tbody>
    {% set old = a.old_data or {} %}
    {% set new = a.new_data or {} %}
    {% set all_keys = (old.keys() | list + new.keys() | list) | unique %}
    {% for key in all_keys %}
    {% set old_value = old.get(key, '—') %}
    {% set new_value = new.get(key, '—') %}
    {% set changed = old_value != new_value %}
    <tr {% if changed %}class="has-background-danger"{% endif %}>
        <td>{{ key }}</td>
        <td>{{ old_value }}</td>
        <td>{{ new_value }}</td>
    </tr>
    {% endfor %}
</tbody>
</table>
</td>
</tr>
{% endfor %}
</tbody>
</table>
{% else %}

<div class="notification is-danger">
Nessuna operazione registrata per questo bene.
</div>

{% endif %}
</div>
</section>
</body>
</html>